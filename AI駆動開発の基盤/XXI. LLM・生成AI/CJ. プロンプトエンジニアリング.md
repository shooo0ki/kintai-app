# CJ. プロンプトエンジニアリング

## 概要

プロンプトエンジニアリングは、LLMから正確な回答を引き出すための技法の体系です。Zero-shot（指示だけ）・Few-shot（例示）・Chain-of-Thought（思考の鎖）・システムプロンプト（ペルソナ定義）を状況に応じて組み合わせることで、生成AIの品質を大幅に向上させます。

---

## 1. Zero-shot プロンプティング

Zero-shotは、例示なしに指示だけで回答させる手法です。実装が簡単で回答が早いメリットがある一方、複雑なタスクでは精度が落ちやすく、出力形式が不統一になる場合があります。

**コツ**
- 指示を具体的かつ明確に書く（「コードについて説明して」ではなく「このコードの目的と各行の役割を説明。初心者向けで50語以内」）
- 期待する出力形式を明記（番号リスト、JSON、表形式など）
- ロール設定を活用（「初心者講師として」「言語設計者として」など視点を指定）

---

## 2. Few-shot プロンプティング

Few-shotは1～数個の具体例を先に示して、「このような形式で答えてほしい」とパターンを認識させる手法です。Zero-shotより精度が高く、出力が統一されます。

**例数の目安**
```
簡単なタスク（分類）     → 1～2例
中程度（変換・要約）     → 2～4例
難しいタスク（推論）     → 4～8例
非常に難しい問題         → 8～16例、またはCoTと併用
```

効果的なFew-shotは、入力例・期待される出力形式を明示することで、LLMが学習パターンを認識しやすくなります。

---

## 3. Chain-of-Thought（CoT）プロンプティング

Chain-of-Thoughtは、LLMに「思考のステップを明示的に書く」よう促す手法です。中間推論過程を見せることで、複雑な問題での正答率が大幅に向上します。

**実装パターン**

```python
# 明示的に思考プロセスを求める例
prompt = """
以下の問題をステップバイステップで解いてください：
1. 問題を理解する
2. 関連情報を整理する
3. 計算または推論を実行
4. 最終回答を述べる

問題: [具体的な問題]
"""
```

**拡張：Tree-of-Thought**
複数の思考経路を並行して探索し、複数案を比較検討する手法。複雑な問題で特に有効です。

---

## 4. システムプロンプト

システムプロンプトはユーザープロンプトの前に配置され、LLMのペルソナ・振る舞い・ルールを定義します。

**構成要素**
- ロール定義：「10年のプログラミング教育経験を持つベテラン講師」など具体的に
- 出力スタイル：技術用語の統一、コード例の必須化、文字数制限など
- 制限事項：セキュリティリスク・違法内容は避けるなど
- フォーマット：常に「概要・詳細・コード例・まとめ」の形式で返す、など

システムプロンプトを設定することで、複数の質問でも一貫した応答が得られます。

---

## 5. プロンプト組み合わせ戦略

各手法の使い分け
```
簡単な質問              → Zero-shot
回答形式の統一が必要    → Few-shot
複雑な推論・問題解決    → Chain-of-Thought
新しい領域・複合要素    → Few-shot + CoT
```

**段階的な改善フロー**
```
段階1：基本的なプロンプト → 低成功率
段階2：詳細な指示を追加 → 改善
段階3：Few-shotで例示 → さらに改善
段階4：CoTでステップを明示 → 最高精度
```

---

## 6. プロンプトの検証と改善

テストケースを用意し、成功率を測定することで、プロンプトの効果を定量化できます。失敗ケースを分析し、Few-shotやCoTの追加、システムプロンプトの見直しを反復すると、段階的に精度が向上します。

```javascript
// シンプルな検証例
const results = testCases.map(tc => {
  const response = llm.generate(prompt + tc.input);
  return { correct: evaluate(response, tc.expected) };
});
const successRate = results.filter(r => r.correct).length / results.length;
```

---

## まとめ

**重点項目**
- **Zero-shot**：シンプルなタスク、迅速な実装向け
- **Few-shot**：出力形式の統一、パターン学習を促す
- **Chain-of-Thought**：複雑な推論では必須
- **システムプロンプト**：一貫した応答を実現
- **段階的改善**：テスト→分析→最適化のループで精度を向上

これらを組み合わせることで、AI駆動開発の生産性と品質が大幅に向上します。
