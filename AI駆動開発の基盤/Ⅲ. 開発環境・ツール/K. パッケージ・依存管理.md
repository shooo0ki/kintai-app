# K. パッケージ・依存管理

## 概要

パッケージマネージャ（npm、pip）は外部ライブラリの依存関係を自動追跡し、ロックファイル（package-lock.json、requirements.txt）で「このプロジェクトはこの正確なバージョンで動く」を記録します。セマンティックバージョニング（MAJOR.MINOR.PATCH）の意味を理解し、バージョン範囲指定（^ キャレット、~ チルダ）で柔軟性と安定性のバランスを取る。直接依存と間接依存を区別し、依存ツリーを可視化することで予期しない版の混在を防ぐ。

### パッケージマネージャと SemVer

npm や pip はインストール先と依存関係を自動管理。キャッシュが古いと矛盾が生じるため、クリーンインストール（rm -rf node_modules && npm install）で問題を再現。

バージョン番号の意味：PATCH（バグ修正、安全に更新）→ MINOR（新機能、互換性あり、テスト推奨）→ MAJOR（破壊的変更、慎重に検討）。

```bash
# 依存追加と更新
npm install express                # 最新版
npm install express@4.18.2         # 特定版
npm install --save-dev jest        # 開発専用
npm update express                 # SemVer範囲内で更新
```

### バージョン範囲指定と依存ツリー管理

package.json では `^4.18.2`（MINOR・PATCH自由）、`~4.17.21`（PATCH自由）、`18.2.0`（完全指定）でバージョンを指定。直接依存と間接依存を区別し、npm ls で依存ツリーを可視化して予期しない版がないか確認。

```bash
# 依存ツリー確認と安全な更新
npm ls
npm ci              # ロックファイル厳密準拠（デプロイ用）
npm audit           # セキュリティ脆弱性検査
npm audit fix       # 自動修復（破壊的変更リスク注意）
```

### クリーンインストールと検証

キャッシュの矛盾を避けるため、開発環境での大幅な更新後はクリーンインストール実施。デプロイでは npm ci で再現性を保証。テストスイートで更新前後の動作確認。
