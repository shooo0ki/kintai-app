# BK. セキュリティ監査・コンプライアンス

## 概要

定期的な脆弱性診断・ペネトレーションテスト・コンプライアンス監査により、継続的にセキュリティ対策を検証します。GDPR、APPI、CCPA等の規制要件への準拠は、法的リスク低減と信頼維持に必須です。

## 脆弱性診断

システムの脆弱性を体系的に特定します。

**自動スキャン**: OWASP ZAP（SQLインジェクション、XSS、CSRF等を検出）、Snyk（パッケージ脆弱性検出）、SonarQube（コード品質・セキュリティ分析）

**CI/CD統合**: git push → npm audit/Snyk スキャン → 脆弱性検出時はビルド失敗・デプロイ阻止 → 修正後に再push

## ペネトレーションテスト

実際の攻撃シナリオで脆弱性を発見。外部セキュリティ企業を起用し、ステージング環境で実施。

**テスト内容**:
1. 情報収集（ドメイン、DNS、ポート、サーバーOS特定）
2. 脆弱性スキャン（Nmap、Nessus、OWASP ZAP、Burp Suite）
3. 脆弱性検証（PoC構築）
4. エクスプロイト（権限昇格、データ抽出確認）
5. レポート作成（詳細、スクリーンショット、修正推奨）

**代表的な攻撃シナリオ**: SQLインジェクション、XSS利用、認証迂回、APIキー漏洩、ファイルアップロード、不正な直接参照（IDOR）、ビジネスロジック破綻

## CVSS スコア

脆弱性の深刻度を0-10で数値化。CRITICAL（9.0-10）は即対応、HIGH（7.0-8.9）は2週以内に修正。

## 修正・再テスト

脆弱性発見 → CVSSスコア+ビジネスインパクトで優先付け → テスト環境で検証 → ステージング→本番環境へデプロイ → 再テストで修正確認。SLA: Critical 24時間、High 7日、Medium 30日、Low 90日以内

## GDPR（欧州）

**主要要件**:
- 明示的な同意（デフォルト無効）
- 忘れられる権利（データ削除要求可能）
- データ移植権（データダウンロード機能）
- データ保護責任者（DPO）配置
- データ保護影響評価（DPIA）

**違反時罰金**: 最大2000万ユーロ または 売上の4%

```javascript
// データ削除APIの実装例
app.delete('/api/user/me', requireAuth, async (req, res) => {
  await User.findByIdAndDelete(req.user.id);
  await UserActivity.deleteMany({ userId: req.user.id });
  logSecurityEvent('USER_DATA_DELETED', { userId: req.user.id });
  res.json({ status: 'deleted' });
});
```

## APPI（日本）・CCPA（カリフォルニア州）

**APPI主要義務**: 個人情報取得時の通知、セキュリティ対策、本人確認と権利対応

**CCPA主要権利**: 知る権利、削除権、オプトアウト、非差別権

## セキュリティ監査チェックリスト

**組織的**: セキュリティポリシー、責任者配置、教育、インシデント対応計画
**技術的**: 資産管理、脆弱性管理、ファイアウォール、暗号化
**運用的**: バックアップ・復旧テスト、パスワードポリシー、権限監査
**コンプライアンス**: 規制特定、プライバシーポリシー、同意管理、DPA締結、違反報告体制

## ベストプラクティス

- 継続的なセキュリティ（年1回以上ペネトレーション、月1回以上スキャン）
- CVSS スコア + ビジネスインパクトで優先付け
- CI/CD に脆弱性スキャン統合
- ステークホルダーへの定期報告とユーザー通知
- セキュリティトレンド監視とチーム教育

## チェックリスト

- [ ] 自動脆弱性スキャン（Snyk、npm audit）がCI/CDに統合
- [ ] 年1回以上のペネトレーション実施計画
- [ ] CVSS スコアに基づく修正優先度付け
- [ ] 脆弱性修正SLA定義
- [ ] 適用規制の特定と準拠状況確認
- [ ] プライバシーポリシーの最新化
- [ ] GDPR/APPI等の同意管理実装
- [ ] インシデント対応計画の策定
- [ ] セキュリティ監査報告書様式準備
- [ ] 修正・再テスト・報告プロセス文書化
