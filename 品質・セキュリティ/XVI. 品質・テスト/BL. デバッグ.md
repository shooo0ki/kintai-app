# BL. デバッグ

## 概要

バグ調査・修正のための系統的なデバッグ手法を学びます。ブレークポイント、ウォッチ式、構造化ログ、スタックトレース解釈などの基本技法により、問題原因を効率的に特定し、解決時間を大幅に短縮できます。

---

## デバッガの基本的な使い方

### ブレークポイントと実行制御

プログラムの指定行で処理を一時停止し、その時点のメモリ・スタック状態を調査します。

**主な操作：**
- **Step Over**: 現在行を実行して次行に進む
- **Step Into**: 関数内に入り込んで追跡
- **Step Out**: 現在の関数から抜け出す
- **Continue**: 次のブレークポイントまで実行

```javascript
function calculateTotal(items) {
  let total = 0;
  for (let i = 0; i < items.length; i++) {
    total += items[i].price;  // ← ここにブレークポイント設定
  }
  return total;
}

// Node.js でのデバッグ実行
// node --inspect-brk=9229 example.js
// その後、Chrome で chrome://inspect にアクセス
```

### ウォッチ式と変数検査

デバッガを一時停止した状態で、特定の変数や式の値をリアルタイムに確認します。複雑なオブジェクトの内部状態を検査する際に有効です。

---

## ログ分析による問題の特定

### 構造化ログの重要性

プログラム実行時の出来事を記録し、本番環境での問題を素早く特定します。タイムスタンプ、ログレベル、メタデータを含めることで、問題原因の追跡が容易になります。

```javascript
class Logger {
  log(level, message, metadata = {}) {
    const logEntry = {
      timestamp: new Date().toISOString(),
      level,
      message,
      ...metadata
    };
    console.log(JSON.stringify(logEntry));
  }
}

// ログレベル: DEBUG < INFO < WARN < ERROR < FATAL
```

### スタックトレースの解釈

エラー発生時にプログラムの実行経路を遡ります。呼び出し元を示すスタック情報から、どの関数チェーンで問題が生じたかを判定。async/await使用時はスタックトレースが読みやすくなります。

---

## 高度なデバッグ技法

### コンディショナルブレークポイント

特定条件でのみ処理を一時停止させる方法です。大量データ処理時に特定レコードのデバッグが必要な場合に活用します。

### ソースマップの活用

TypeScriptやBabelでトランスパイルされたコード内でも、元のソースコードでデバッグできます。`.map`ファイルによってコンパイル前後のコード対応が保証されます。

---

## デバッグのベストプラクティス

### 効果的なログ戦略

コンテキストと詳細情報を含め、ユーザーID、リクエストID、エラーコード、メッセージ、タイムスタンプなどを記録します。後の分析が容易になります。

### デバッグセッションの記録

複雑な問題では、調査過程を記録することで後の参考になります。どのステップで何を確認し、どのように原因を特定したかをドキュメント化します。
