# BT. ネットワーク設計 - Sprint 1

## 概要

ネットワーク設計は、クラウドインフラにおいて安全で効率的なデータ通信を実現するための基礎です。Sprint 1では、VPCの基本概念、サブネット設計、ロードバランサーを習得します。

---

## 1. VPC の基本概念

### VPC とは

VPC（Virtual Private Cloud）は、AWS クラウド内に作成する専有のネットワーク空間です。物理的なデータセンター内にプライベートネットワークを構築するのと同じ感覚で、クラウド上に独立したネットワークを用意。

複数の VPC を独立させることで、開発・ステージング・本番環境を完全に隔離できます。

**構成要素：** CIDR ブロック（IP 範囲指定）、Subnet（ネットワークの分割）、Internet Gateway（インターネット接続）、NAT Gateway（プライベート→外部通信）、Route Tables（ルーティング規則）。

---

### CIDR ブロックと IP アドレス管理

**CIDR 記法：** 10.0.0.0/16 は「ベースアドレス＋プレフィックス長」。/16 は最初の16ビットがネットワークアドレス、残り16ビットがホストアドレス。65,536 個のアドレス。

**一般的な CIDR：**
- /8（クラスA）：16,777,216 個
- /16（クラスB）：65,536 個
- /24（クラスC）：256 個
- /30：4 個

**設計例：** VPC 10.0.0.0/16→Subnet1 10.0.1.0/24（AZ-1a）、Subnet2 10.0.3.0/24（AZ-1c）。残り 10.0.2.0/24 以降は将来の拡張用に予約。

---

### パブリック vs プライベートサブネット

セキュリティ観点から、全リソースをインターネットに公開してはいけません。

**パブリックサブネット：** Internet Gateway に接続。ALB（ロードバランサー）など外部との接点のみ配置。

**プライベートサブネット：** Internet 未接続。EC2（アプリサーバー）、RDS（データベース）、Cache など内部システムを配置。外部通信は NAT Gateway 経由。

**フロー：** インターネット→IGW→ALB→EC2→RDS、 EC2→NAT Gateway→IGW→インターネット（npm install 等）。

---

## 2. サブネット設計

### 複数 AZ への分散

高可用性のため、複数のアベイラビリティゾーン（AZ）に同一構成を配置。一つのAZで障害が発生しても、他のAZで処理継続。

**構成：** AZ-1a に Subnet 10.0.1.0/24、EC2、RDS Primary。AZ-1c に Subnet 10.0.3.0/24、EC2、RDS Read Replica。ALB は複数 AZ にまたがり、自動的にトラフィック分散。

**効果：** AZ-1a 障害→AZ-1c で処理継続、低遅延（同一リージョン内）、RDS 冗長化で高可用性。

---

### ルートテーブルとネットワークルーティング

ルートテーブルは、パケットの宛先に応じて送信先を決定します。

**パブリックサブネットの例：**
- Destination 10.0.0.0/16（VPC内）→ Target local（VPC内ルーティング）
- Destination 0.0.0.0/0（外部全て）→ Target igw-xxxxx（インターネット出口）

**プライベートサブネットの例：**
- Destination 10.0.0.0/16（VPC内）→ Target local
- Destination 0.0.0.0/0（外部）→ Target nat-xxxxx（NAT Gateway 経由）

**効果：** インバウンド接続はブロック（VPC内からのみ接続可）、アウトバウンドは NAT Gateway 経由で許可。

---

## 3. ロードバランサー

### ロードバランシング

単一サーバーではアクセス集中に対応できません。複数サーバーを用意し、ロードバランサーがトラフィックを分散することで、高可用性と高パフォーマンスを実現。

**効果：** トラフィック分散で負荷軽減、1台落ちても他が対応（HA）、サーバー追加で簡単スケーリング。

---

### ALB（Application Load Balancer）

HTTP/HTTPS レイヤーでのロードバランシング機能を提供。URL パスやホスト名によるルーティングが可能。

**ルーティングルール例：**
- Path が /api/* →api-servers へ転送
- Path が /admin/* →admin-servers へ転送
- その他→web-servers へ転送

これにより、1つの ALB で複数のバックエンドグループを管理可能。

---

### ターゲットグループとヘルスチェック

ロードバランサーは定期的にバックエンドサーバーの健全性を確認し、応答なしのサーバーを自動的に除外します。

**ヘルスチェック設定：** Protocol（HTTP）、Path（/health）、Port（8080）、Healthy threshold（2回連続成功で healthy）、Unhealthy threshold（3回連続失敗で unhealthy）、Interval（30秒ごとチェック）。

**動作フロー：** 異常サーバーを検出→トラフィック転送停止→復旧確認後→再度トラフィック転送開始。

---

## チェックポイント

- [ ] VPC の概念と構成要素を説明できる
- [ ] CIDR 記法を理解し、IP 範囲を計算できる
- [ ] パブリック/プライベートサブネットの使い分けを説明できる
- [ ] 複数 AZ 構成のメリットを説明できる
- [ ] ルートテーブルによるルーティング方式を説明できる
- [ ] ロードバランシングの必要性を説明できる
- [ ] ALB のルーティングルール機能を説明できる
- [ ] ヘルスチェックの仕組みを説明できる
